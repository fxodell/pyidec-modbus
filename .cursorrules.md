# NFM Consulting - Cursor Repo Rules
# Scope: This file applies to the entire repository.
# Purpose: Make Cursor behave like a careful senior engineer: minimal diffs, no guessing, verify with repo evidence.

## Core Behavior (HARD RULES)
- Always read repository files before proposing edits.
- Do NOT guess file paths, symbols, URLs, environment variables, or config values.
- Prefer minimal, reversible changes over refactors.
- Match existing project patterns and conventions exactly.
- If requirements are unclear, ask 1–3 precise questions instead of making assumptions.
- Never claim something is implemented unless you can point to the exact file path and code snippet.

## Required First Steps (Before Any Change)
1) Read `docs/CURSOR_RULES.md` (if present).
2) Read `docs/CONTEXT.md` and `docs/TASKS.md` (if present).
3) Identify the existing implementation in the repo BEFORE writing new code:
   - relevant urls.py routes
   - views.py / view modules
   - templates and base layout
   - CSS / Tailwind patterns and design tokens
   - existing service pages and card components

## Output Format (STRICT)
Always respond using this format:

PLAN:
- 3–6 bullets referencing real repo file paths

CHANGES:
- file: <path>
  - what changed + why (1–3 bullets)

TEST:
- command: <command>
  expected: <expected result>

## Django / Templates Rules
- Follow existing Django app structure in this repo.
- Reuse existing templates, blocks, partials, and components.
- Do not introduce a new template folder structure unless the repo already uses it.
- Use consistent heading hierarchy (H1 once per page, then H2/H3).
- Prefer server-rendered templates over adding JS frameworks unless already used.

## Styling Rules (Tailwind / CSS)
- Reuse existing card/layout styles and class names.
- Do NOT invent a new design system.
- If Tailwind utilities are used in existing services pages, reuse them.
- If custom CSS exists (design system stylesheet), add new CSS only if truly necessary.
- Keep spacing, colors, and typography consistent with existing service detail pages.
- **Text Contrast on Gradients**: On gradient background cards (`bg-gradient-to-br`), always use:
  - `text-white` explicitly on headings (even if parent has `text-white`)
  - `text-white/90` on paragraph text (NOT color-specific classes like `text-purple-100`, `text-cyan-100`)
- **Service Slug Consistency**: Always use correct service slugs:
  - `oil-gas-integration` (NOT `oil-and-gas` or `oil-gas-field-automation`)
  - `nanofiltration` (NOT `water-treatment-automation`)
  - `fiber-optics` (NOT `fiber-optic-solutions`)
  - Check `apps/services/views.py` `specialized_templates` dictionary for current slugs

## Safety / Architecture Rules
- No architecture changes without documenting via ADR:
  - check `docs/DECISIONS.md` (or equivalent) before major structural changes
- Do NOT modify unrelated code.
- Do NOT rename routes, templates, or components unless required and referenced everywhere.

## DevOps / Deployment Rules (When Relevant)
- Any Nginx/Docker Compose/TLS change must be small, explicit, and reversible.
- Do not change production ports, hostnames, or TLS settings unless requested.
- If editing compose files, preserve existing network/service naming patterns.
- If editing Nginx, avoid breaking existing upstreams and routes.

## Verification Requirements
- If tests exist, run the smallest relevant subset.
- At minimum, include:
  - `python manage.py check`
  - and a run command or curl check if applicable
- If you can’t run commands, provide the exact commands for the user to run.

## When Adding New Pages (Services)
- Add the new service to the Services index page using the existing card pattern.
- Add a dedicated service detail page using the same structure as existing service pages.
- Ensure URL is clean and consistent (e.g., `/services/<slug>/`).
- Confirm nav links, buttons, and card links are correct.
- **CRITICAL**: If creating a specialized template service:
  - Add the slug → template mapping to `specialized_templates` dictionary in `apps/services/views.py`
  - Specialized templates can work without database entries
  - Use consistent slug naming (kebab-case, matches template filename)
- **CRITICAL**: When using gradient backgrounds on cards:
  - Always add explicit `text-white` to headings (don't rely on parent class)
  - Use `text-white/90` for paragraph text on gradient backgrounds (not color-specific classes like `text-purple-100`)
  - Test text visibility on all gradient color combinations

## Do Not Do
- Do not output huge code dumps if only small edits are needed.
- Do not “improve” formatting across unrelated files.
- Do not upgrade dependencies unless explicitly requested.
- Do not introduce new libraries unless approved.
